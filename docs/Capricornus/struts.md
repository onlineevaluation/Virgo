# 结构

项目基本是采用 Go 的协程完善的一个代码。基本实现思路如下。

1. 编译程序，确保程序可以通过编译
2. 对程序进行运行
3. 监听运行过程，包括时间内存等。

## 主要函数

### judegeCode

这个函数为外部调用的入口函数，通过注释，使函数打包时，提供入口

```go
//export judgeCode
func judgeCode(filePath, outputPath, fileName string, data string, limitTime int64) *C.char 
```

#### 输入参数说明

| 名称       | 类型   | 说明                      |
| ---------- | ------ | ------------------------- |
| filePath   | string | 要编译的文件路径          |
| outputPath | string | 输出文件路径              |
| fileName   | string | 输出文件名称              |
| data       | string | 测评数据格式 详细格式如下 |
| limitTIme  | int64  | 代码运行时间              |

json 采用 `#$%  %$#` 进行包含，非 ascii 码会报错，所以在试题编辑和试题测试数据的时候要注意这一点

```json
{
  "datas": [
    {
      "input": "#$%1,2%$#",
      "output": "#$%3%$#"
    },
    {
      "input": "#$%3,6%$#",
      "output": "#$%9%$#"
    }
  ]
}
```



#### 返回值说明

| 名称         | 类型    | 说明                    |
| ------------ | ------- | ----------------------- |
| 返回运行结果 | *C.char | 运行结果说明,返回状态码 |

状态码说明


- 0 没有安装 gcc 环境
- 1 代码无法进行编译
- 2 运行超时
- 3 运行出错
- 4 未知错误
- 5 json格式错误
- 8 部分运行结果错误
- 9 运行全部通过

### runInWindows

通过对当前系统判断，如果是 windows 操作系统，则进行该函数运算。

::: tip 为什么要这样

在 `*nix` 中，通过终端执行命令基本相同，而 `windows` 中 通过 `cmd` 或者 `powershell` 进行执行，命令参数与 `*nix` 中很多不一样，故专门用改函数进行处理。

:::

首先对目标文件进行编译，确保编译正确后，在运行。

```shell
gcc -pedantic [filePath] -o [filename]
```

在编译之前，通过如上命令可以对目标文件进行错误检查，并返回错误情况。

在这里终端使用的是 `powershell` 。 使用 `cmd` 无法获取错误信息流。

### runInXnix

在linux环境下和macos下进行该函数，目前并未测试过 macOS 下的可用性。

在 linux 下通过 bash 终端进行交互，基本命令和 windows 下的状况下一样。

猜想：

如果给linux安装好powershell是不是就可以按照windows运行环境进行？？

### judeg

judge 函数对目标文件进行计时，并且通过协程对编译后的可执行文件进行运行。当运行超时时，对该可执行文件进行处理，将其进程杀死。

### runCode

该函数主要对输入输出数据进行处理，通过将数据读入 终端，之后对输出数据和答案进行比对，得出正确答案。



